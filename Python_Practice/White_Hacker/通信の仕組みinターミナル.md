# ターミナルを使った通信・セキュリティ体験

通信を見て・守って・理解しよう！
ping・netstat・ufw で学ぶネットワークの基本とセキュリティ


・使用環境

	推奨: Raspberry Pi（Raspberry Pi OS) または LinuxOS
	  (同じLAN上に接続されたPC(OSはなんでもOK)を2台用意)
	
	接続方法：SSHまたはモニタ付きで直接操作
	
	使用コマンド：ifconfig, ping, netstat, ufw

Linuxの仮想環境は以下のサイトをお勧めします。ただし,講師・生徒間の通信は不可能です。
(サイトを開き,表の1番上のStartupLinkをクリック)

```
https://bellard.org/jslinux/
```


・授業の目的
	1.	通信がどのように行われているかを理解する
	2.	自分の端末で「どんな通信が起きているか」を見る
	3.	ファイアウォールで通信を制御する仕組みを体験する

-

## セクション1: 自分の住所（IPアドレス）を調べよう（目標時間: 5分）

- windowsユーザー : CommandPrompt(コマンドプロンプト)アプリを開こう
- Mac・LinuxOS・RaspberryPi OS ユーザー: Terminal(ターミナル)アプリを開こう


ターミナル/コマンドプロンプトで以下のコマンドを入力しよう(WindowsOSでは`ipconfig`に変更)

```
ifconfig en0
```

inet 192.168.x.x を見つけてみよう。使用している端末のIPアドレスになるので, 出てきた値をメモしておこう。

---

以下じっこうのセクションではRaspberryPi環境とMacOS環境を想定しています
ファイアウォールの設定の操作はミスが発生すると危ないため自身が無い方には推奨しません。

## セクション2: pingで通信してみよう（目標時間: 10分）

先生のIPアドレスのx.xの部分を入力して, 対象のIPアドレスと通信が可能か確認してみよう。
(先生は同様に生徒のアドレスにネットワーク疎通確認を送信)

```
ping -c 3 192.168.x.x
```

・画面に「64 bytes from …」と出るのを確認。出てきたら通信成功。出なければ失敗

通じない場合は以下を行おう(通じない可能性が高いです)

```
ping -c 3 192.168.1.1
```


## セクション3: netstatで通信の中身を見てみよう（目標時間: 10分）

1. 現在の通信を確認

以下を入力

```
netstat -an
```


2. 経路を確認しよう

```
traceroute 192.168.1.1
```


3. 表の一部を記録して理解

| 状態 | 意味 | 
| ------- | --------------------------|
| LISTEN | 相手からの通信を待っている |
| ESTABLISHED | 通信がつながっている |
| TIME_WAIT | 通信が終わったあと少し待機 |

---


以下のセクション4はファイアウォールがOFFになっていた場合のみ行う(基本はONになっているはずなので操作しないことをお勧めします)

## セクション4: ファイアウォールを設定しよう

1.状態確認

```
sudo ufw status
```


2.ファイアウォールをON(以下のコマンドまたは手動)

```
sudo ufw enable
sudo ufw default deny incoming
sudo ufw default allow outgoing
```

pingをもう一度実行し, 通信が遮断され, 届かなくなったことを確認してみよう。

---

## まとめ

| コマンド | 体験内容 | セキュリティ上の意味 |
| ---------- | ------------- | ----------------------------|
|ifconfig |IPアドレスを調べる|自分の住所を知る|
|ping|通信の到達確認|相手の存在を確かめる|
|netstat|通信の状態を観察|誰と通信しているかを見る|
|ufw enable|通信を制御する|不要な通信をブロックする

---

・以下の内容は無視してください

片付け・安全に戻す方法

状態確認

```
sudo ufw status numbered
```

ファイアウォールOFF

```
sudo ufw disable
```

設定リセット（任意）

```
sudo ufw reset
```


